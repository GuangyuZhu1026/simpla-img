<link rel="import" href="../polymer/polymer.html"> <link rel="import" href="../simpla-element-behavior/simpla-element-behavior.html"> <dom-module id="simpla-img"> <script>!function(){"use strict";var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAQAAAA3fa6RAAAADklEQVR42mNkAANGCAUAACMAA2w/AMgAAAAASUVORK5CYII=",e={width:180,height:130},i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},r=function(){function t(t,e){var i=[],r=!0,a=!1,n=void 0;try{for(var o,l=t[Symbol.iterator]();!(r=(o=l.next()).done)&&(i.push(o.value),!e||i.length!==e);r=!0);}catch(t){a=!0,n=t}finally{try{!r&&l.return&&l.return()}finally{if(a)throw n}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a={editable:{cursor:"pointer"},active:{visibility:"hidden",transition:"visibility",transitionDelay:"50ms"},placeholder:{minHeight:e.height+"px",minWidth:e.width+"px",backgroundSize:"cover",backgroundPosition:"center center",opacity:"0.75"}},n={is:"simpla-img",extends:"img",properties:{src:{type:String,reflectToAttribute:!0,value:function(){return t},notify:!0},alt:{type:String,reflectToAttribute:!0,value:"",notify:!0},placeholder:{type:String,value:""},editable:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},active:{type:Boolean,notify:!0,value:!1}},observers:["_importEditor(editable)","_updateEditorImage(active)","_styleEditable(editable)","_styleEditing(active)","_showPlaceholder(placeholder, editable, src)"],listeners:{tap:"_tapHandler"},behaviors:[SimplaBehaviors.Element],created:function(){this.setupSimpla({type:"Image",dataProperties:["src","alt"],getCallback:"_updateElement",setCallback:"_updateSimpla"})},_styleEditable:function(t){this._toggleStyles(a.editable,t)},_styleEditing:function(t){this._toggleStyles(a.active,t)},_showPlaceholder:function(e,r,n){var o=r&&n===t,l=void 0;e||(e="url("+this.resolveUrl("placeholder.gif")+")"),l=i({background:e},a.placeholder),this._toggleStyles(l,o)},_toggleStyles:function(t,e){var i=this,a=this.__styleCache=this.__styleCache||{};(function(t){return Object.keys(t).map(function(e){return[e,t[e]]})})(t).forEach(function(t){var n=r(t,2),o=n[0],l=n[1],s=a[o],c=i.style[o];e?a[o]=c:(a[o]="",l=s||""),i.style[o]=l})},_updateElement:function(t){this.__comingFromSimpla=!0,i(this,t.data),this.__comingFromSimpla=!1},_updateSimpla:function(){if(this.path&&!this.__comingFromSimpla&&this.src!==t)return Simpla.set(this.path,{type:"Image",data:{src:this.src,alt:this.alt}})},_tapHandler:function(){this.editable&&(this.active=!0)},_updateEditorImage:function(t){var e=document.querySelector("simpla-img-editor");e&&(e.image=t?this:null)},_importEditor:function(t){var e=!!document.querySelector("simpla-img-editor"),i=void 0;t&&!e&&(this.importHref(this.resolveUrl("simpla-img-editor.html")),i=document.createElement("simpla-img-editor"),document.body.appendChild(i))}};Polymer(n)}()</script> </dom-module> 